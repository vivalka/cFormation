pipeline
{
   agent any
   stages
   {
     stage("scm checkout")
	 {
	 steps
		{
			git 'https://github.com/vivalka/maven-project'
		}
	 }
	 
	 stage("compile source code")
	 {
	 steps
		{
			withMaven(jdk: 'jdkLocal-8', maven: 'localMaven') 
			{
				sh 'mvn compile'	
			}
		}
	 }
	 
	 
	 
	 stage("test")
	 {
	 steps
		{
			withMaven(jdk: 'jdkLocal-8', maven: 'localMaven') 
			{
				sh 'mvn test'	
					
			}
		}
	 }
	 
	 stage("build my job")
	 {
	 steps
		{
			withMaven(jdk: 'jdkLocal-8', maven: 'localMaven') 
			{
				sh 'mvn package'	
					
			}
		}
	 }
	 
	 stage("S3 dev deployment")
	 {
	 steps
		{
			sshagent(['deployS3']) {
			
			withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'aws-key', accessKeyVariable: 'AWS_ACCESS_KEY_ID',secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]) {
      
    
    				
    				sh 'aws deploy push */target/*.war --s3-location s3://codedeploydemobucketvivek --ignore-hidden-files'
  			}	
			}
		}
	 }
	 
	 
   }
   
}
